{% extends "base.html" %}
{% set active = "export" %}
{% block title %}Export File | BioCycle{% endblock %}

{% block content %}

<h4 class="mb-4">Export Data Sensor</h4>

<div class="card p-4 mb-4">
    <h6>ðŸ“¦ Pilihan Export</h6>
    <p class="text-muted">Export semua data ke Excel atau PDF.</p>

    <div class="d-flex gap-3">
        <a href="/export_excel" class="btn btn-success">ðŸ“— Export ke Excel</a>
        <a href="/export_pdf" class="btn btn-danger">ðŸ“• Export ke PDF</a>
    </div>
</div>

<div class="card p-3">
    <h6>ðŸ“‹ Data Sensor (20 Data Terakhir)</h6>
    <table class="table table-striped mt-2">
        <thead>
            <tr>
                <th>No</th>
                <th>Waktu</th>
                <th>Suhu</th>
                <th>Kelembapan</th>
                <th>Tekanan</th>
                <th>Gas</th>
                <th>Motor</th>
                <th>Solenoid</th>
            </tr>
        </thead>
        <tbody id="exportTable">
            <tr><td colspan="8" class="text-center">Memuat data...</td></tr>
        </tbody>
    </table>
</div>

{% endblock %}

{% block scripts %}
<script>
async function fetchExportData() {
    const response = await fetch('/get_sensor_history');
    const data = await response.json();
    const tbody = document.getElementById('exportTable');
    tbody.innerHTML = "";

    data.slice().reverse().forEach((row, i) => {
        tbody.innerHTML += `
            <tr>
                <td>${i + 1}</td>
                <td>${row.timestamp}</td>
                <td>${row.temperature.toFixed(2)}</td>
                <td>${row.humidity.toFixed(2)}</td>
                <td>${row.pressure.toFixed(2)}</td>
                <td>${row.mq.toFixed(2)}</td>
                <td>${row.motor_status}</td>
                <td>${row.solenoid_valve}</td>
            </tr>`;
    });
}
fetchExportData();
setInterval(fetchExportData, 10000);
</script>
{% endblock %}
